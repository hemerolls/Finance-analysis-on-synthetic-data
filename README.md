# Анализ риска дефолта по кредитам

## 📌 Описание проекта
Цель проекта — построить модель предсказания дефолта (или другого целевого события) на основе данных о клиентах: демография, доходы, сбережения, условия кредита и т.д.

Модели обучались с использованием:
- Логистической регрессии
- Случайного леса
- Градиентного бустинга

С метриками: ROC-AUC, F1-score, precision, recall.

---

## 🔧 Этапы обработки данных

1. **Обработка пропусков**  
   - Категориальные признаки: заполнение значением `'None'`
   - Числовые: логарифмирование и заполнение медианой (позже заменено на KNN-импутацию)

2. **Кодирование категориальных признаков**  
   - `LabelEncoder` для: `gender`, `education_level`, `employment_status`, `region`, `loan_type`, `has_loan`

3. **Нормализация числовых признаков**  
   - `StandardScaler` для всех числовых столбцов

4. **Анализ утечек данных (data leakage)**  
   Проведён детальный анализ признаков на предмет "просачивания" будущей информации.

5. **Удаление признаков-утечек**  
   Удалены признаки, которые:
   - Рассчитываются после выдачи кредита
   - Зависят от решения банка
   - Слишком сильно коррелируют с целевой переменной

6. **PCA и анализ важности признаков**  
   - Для интерпретации
   - Для поиска скрытых паттернов

---

## 🚫 Удалённые признаки (data leakage)

Следующие признаки были удалены как потенциальные утечки:

| Признак | Причина удаления |
|--------|------------------|
| `loan_interest_rate_pct` | Устанавливается **после** оценки риска — не может быть известен до |
| `monthly_emi_usd` | Рассчитывается от суммы, срока и ставки — **нельзя знать до выдачи** |
| `debt_to_income_ratio` | Содержит долг по **этому кредиту** — утечка будущего |
| `savings_to_income_ratio` | Подозрительный расчётный признак, почти не влиял, удалён для честности |

⚠️ Признаки `loan_amount_usd`, `loan_term_months`, `loan_type` были **временно удалены**, но позже признаны **безопасными** (если `y` — дефолт, а не одобрение).

---

## 📊 Метрики моделей (до и после очистки)

### После удаления утечек:
`Logistic Regression: Test ROC-AUC = 1.000`
`Random Forest: Test ROC-AUC = 1.000`
`Gradient Boosting: Test ROC-AUC = 1.000`

Даже после удаления всех подозрительных признаков модели достигали **идеальных метрик (ROC-AUC = 1.0)**.

---

## ⚠️ Критический вывод: данные — синтетические

Несмотря на тщательную очистку от утечек и подозрительных признаков, модели продолжали достигать **идеального качества (ROC-AUC = 1.0)**.

Это **невозможно в реальной задаче кредитного скоринга**, где:
- Поведение клиентов непредсказуемо
- Даже лучшие модели редко превышают ROC-AUC = 0.85–0.90
- Удаление ключевых признаков должно **сильно снижать качество**

### Признаки синтетичности:
1. **Идеальные метрики** после удаления утечек
2. **Нулевое влияние реальных предикторов риска** (например, `credit_score`, `monthly_income_usd`)
3. **Аномально высокая корреляция у "безопасных" признаков** (например, `loan_amount_usd`: +0.801)
4. **Отсутствие шума** — типично для сгенерированных данных

👉 Скорее всего, **целевая переменная `y` была сгенерирована на основе признаков** по простому правилу, например:
```python
y = (loan_amount_usd > 10000) | (credit_score < 500) или y = 1 - (loan_approved)
